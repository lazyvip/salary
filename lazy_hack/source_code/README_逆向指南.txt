====================================================================================================
Python 软件逆向完整指南
====================================================================================================

【工具准备】

1. PyInstaller 提取工具
   - pyinstxtractor: pip install pyinstxtractor
   - PyInstaller Extractor (GUI 版本)

2. Python 字节码反编译工具
   - uncompyle6: pip install uncompyle6 (支持 Python 2.7, 3.2-3.8)
   - decompyle3: pip install decompyle3 (支持 Python 3.7+)
   - pycdc: https://github.com/zrax/pycdc (支持更多版本)

3. 分析工具
   - IDA Pro / Ghidra (高级分析)
   - Hex Editor (查看二进制)
   - Python 调试器 (pdb)

====================================================================================================
【逆向流程】
====================================================================================================

步骤1: 识别打包方式
----------------------------------------------------------------------------------------------------
运行: 1_extract_pyinstaller.py

这个脚本会:
- 使用 pyinstxtractor 提取 PyInstaller 打包的 exe
- 提取出所有的 .pyc 字节码文件和依赖库
- 输出目录: AI批量生图工具_2.0.14.exe_extracted/

关键文件:
- 主程序.pyc (通常与 exe 同名或叫 __main__.pyc)
- PYZ-00.pyz_extracted/ (包含所有导入的模块)

步骤2: 反编译字节码
----------------------------------------------------------------------------------------------------
运行: 2_decompile_pyc.py

这个脚本会:
- 遍历所有 .pyc 文件
- 尝试使用多种工具反编译
- 输出可读的 .py 源代码文件
- 输出目录: decompiled/

注意:
- 某些混淆的代码可能无法完全还原
- 变量名可能被混淆
- 需要手动整理代码格式

步骤3: 分析授权机制
----------------------------------------------------------------------------------------------------
运行: 3_analyze_license.py

这个脚本会:
- 搜索所有与授权相关的代码
- 查找机器码生成函数
- 查找授权码验证函数
- 生成分析报告

重点关注:
1. 机器码如何生成?
   - MAC 地址? (uuid.getnode())
   - CPU ID? (wmic cpu get ProcessorId)
   - 硬盘序列号? (wmic diskdrive get SerialNumber)
   - 组合信息?

2. 授权码如何生成/验证?
   - 哈希算法 (MD5, SHA256)
   - 加密算法 (AES, RSA)
   - 简单字符串处理
   - 在线验证还是离线验证?

3. 验证流程
   - 启动时验证?
   - 定期验证?
   - 联网验证?

步骤4: 编写破解工具
----------------------------------------------------------------------------------------------------
运行: 4_crack_keygen.py

根据步骤3的分析结果,修改这个注册机模板:

1. 确定机器码获取方式
   修改 get_machine_code_methodX() 函数

2. 确定授权码生成算法
   修改 generate_license_algorithmX() 函数
   
   常见算法:
   - 授权码 = MD5(机器码)
   - 授权码 = MD5(机器码 + 固定Salt)
   - 授权码 = AES_Encrypt(机器码, 密钥)
   - 授权码 = 机器码经过某种变换

3. 测试验证
   使用原软件测试生成的授权码是否有效

====================================================================================================
【常见授权机制分析】
====================================================================================================

类型1: 简单哈希
----------------------------------------------------------------------------------------------------
特征: 授权码 = Hash(机器码 [+ Salt])

破解方法:
1. 找到哈希函数和Salt
2. 直接计算授权码

示例代码:
    machine_code = get_machine_code()
    license_key = hashlib.md5(f"{machine_code}YOUR_SALT".encode()).hexdigest()

类型2: 对称加密
----------------------------------------------------------------------------------------------------
特征: 授权码 = AES/DES_Encrypt(机器码, 密钥)

破解方法:
1. 提取加密密钥和IV
2. 实现相同的加密逻辑

示例代码:
    from Crypto.Cipher import AES
    cipher = AES.new(key, AES.MODE_CBC, iv)
    license_key = cipher.encrypt(machine_code)

类型3: 非对称加密
----------------------------------------------------------------------------------------------------
特征: 使用私钥签名,公钥验证

破解方法:
1. 提取私钥(如果在代码中)
2. 或修补验证逻辑

类型4: 在线验证
----------------------------------------------------------------------------------------------------
特征: 连接服务器验证授权

破解方法:
1. 修补网络请求逻辑
2. 本地搭建验证服务器
3. Hook 网络函数返回成功

====================================================================================================
【高级技巧】
====================================================================================================

1. 如果反编译失败
----------------------------------------------------------------------------------------------------
- 尝试不同版本的反编译工具
- 手动分析字节码 (使用 dis 模块)
- 使用动态调试 (pdb, 在运行时分析)

2. 如果代码混淆严重
----------------------------------------------------------------------------------------------------
- 使用动态调试,运行时查看变量值
- Hook 关键函数
- 使用 Python tracer 记录执行流程

3. 如果有反调试措施
----------------------------------------------------------------------------------------------------
- 查找并删除反调试代码
- 使用虚拟机隔离环境
- Hook 系统调用

4. 内存补丁
----------------------------------------------------------------------------------------------------
- 找到验证函数的返回值
- 直接修改返回 True
- 使用 frida 等工具动态注入

====================================================================================================
【法律声明】
====================================================================================================

本工具仅供安全研究和学习目的使用。
请遵守相关法律法规,不要用于非法用途。
逆向工程应该用于:
- 安全研究
- 兼容性分析  
- 学习目的
- 漏洞发现

不应该用于:
- 盗版软件
- 商业竞争
- 侵犯知识产权

====================================================================================================
【使用顺序】
====================================================================================================

1. 运行 1_extract_pyinstaller.py     -> 提取 exe
2. 运行 2_decompile_pyc.py           -> 反编译字节码
3. 运行 3_analyze_license.py         -> 分析授权机制
4. 修改 4_crack_keygen.py            -> 编写注册机
5. 测试验证                           -> 验证是否成功

====================================================================================================
【常见问题】
====================================================================================================

Q: 提取失败怎么办?
A: 确认是 PyInstaller 打包的,尝试其他提取工具如 py2exe extractor

Q: 反编译失败?
A: Python 版本不匹配,尝试不同的反编译工具,或使用 pycdc

Q: 找不到授权相关代码?
A: 可能使用了代码混淆,尝试搜索字符串 "license", "key", "activation"

Q: 生成的授权码无效?
A: 仔细对比源码中的算法,检查每个细节(大小写、编码、Salt等)

Q: 代码无法运行?
A: 检查依赖库是否完整,可能需要手动安装缺失的模块

====================================================================================================
