{
  "analysis_time": "2025-10-13T00:16:28.683501",
  "website_url": "https://storynook.cn",
  "javascript_analysis": {
    "supabase-client.js": {
      "file_size": 3148,
      "functions": [
        "updateData",
        "deleteData",
        "fetchData",
        "insertData"
      ],
      "ajax_calls": [
        ".delete("
      ],
      "api_endpoints": [
        "Supabase插入错误:",
        "supabase全局对象未找到，确保正确引入CDN",
        "Supabase查询错误:",
        "Supabase删除错误:",
        "https://cxtvmolpayeplvdxcjvf.supabase.co",
        "初始化Supabase客户端时出错:",
        ";\n\n\n// 从全局supabase对象中解构出createClient方法\nlet supabaseClient;\ntry {\n  // 检查supabase是否已定义\n  if (typeof supabase !== ",
        "Supabase更新错误:",
        ") {\n    const { createClient } = supabase;\n    console.log(",
        ") {\n      supabaseClient = createClient(supabaseUrl, supabaseKey);\n      console.log("
      ],
      "story_related": [],
      "routing_logic": [],
      "database_operations": [
        "supabaseClient;",
        "supabaseUrl = 'https://cxtvmolpayeplvdxcjvf.supabase.co';",
        "Supabase客户端",
        "supabase !== 'undefined') {",
        ".from(",
        ".insert(",
        ".update(",
        "supabase对象中解构出createClient方法",
        "supabaseClient = createClient(supabaseUrl, supabaseKey);",
        ".select(",
        "supabase;",
        ".eq(",
        "supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4dHZtb2xwYXllcGx2ZHhjanZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU1NTE0NTgsImV4cCI6MjA2MTEyNzQ1OH0.LIBg-OUlZHE6jtct1hRBFn1uOw6upqyDOCK-qBqaXic';",
        "supabase全局对象已找到, createClient:', createClient);",
        "supabase是否已定义"
      ]
    },
    "app.js": {
      "file_size": 49458,
      "functions": [
        "renderStories",
        "loadStoryDetail",
        "performSearch",
        "getRandomInt",
        "toggleFunctionDropdown",
        "handleSearchKeydown",
        "populateCategorySettings",
        "ttsResume",
        "loadUserCategorySettings",
        "ttsReplay",
        "checkSavedViewMode",
        "loadStories",
        "updateTTSButton",
        "updateCategoryLimitWarning",
        "saveUserCategorySettings",
        "renderCategories",
        "closeCategorySettingsModal",
        "toggleViewMode",
        "showWelcomeAnimation",
        "toggleSidebar",
        "hideLoading",
        "closeSearchBox",
        "checkSavedTheme",
        "ttsStart",
        "handleResponsiveSidebar",
        "loadMoreStories",
        "resetTTSState",
        "showToast",
        "refreshHome",
        "openCategorySettingsModal",
        "ttsStop",
        "loadCategories",
        "makeNavScrollable",
        "initSidebar",
        "showArticle",
        "toggleTheme",
        "toggleSearchBox",
        "ttsPause",
        "handleCategoryChange",
        "showHome",
        "checkIfScrollNeeded",
        "handleScroll",
        "ttsPlay",
        "showLoading",
        "initSearch"
      ],
      "ajax_calls": [],
      "api_endpoints": [
        ",ascending:false}\n        }\n\n        // 直接调用window.supabaseClient中的方法\n        const { data, error } = await window.supabaseClient.fetchData(",
        "查询Supabase数据出错:",
        ",ascending:true},\n            pagination:{page:currentState.currentPage,pageSize:50},\n            filter:{},\n            filterLike:{}\n        }\n\n        // 添加分类参数\n        if (currentState.activeCategoryId) {\n            options.filter = {category_id:currentState.activeCategoryId}\n        }\n\n        if(currentState.searchKeyword){\n            options.filterLike = {title:currentState.searchKeyword};\n        }\n\n        const { data, error } = await window.supabaseClient.fetchData(",
        ">\n                        获取故事内容时遇到了一些问题，请稍后再试。\n                    </div>\n                </div>`;\n        }\n    } finally {\n        // 标记为加载完成\n        currentState.isLoading = false;\n        // 隐藏加载遮罩\n        hideLoading(append, scrollPos);\n    }\n}\n\n// 加载故事详情\nasync function loadStoryDetail(story) {\n    // 显示加载遮罩\n    showLoading();\n\n    // 重置TTS状态\n    resetTTSState();\n\n    try {\n        const options = {filter:{story_id:story.id}}\n        const { data, error } = await window.supabaseClient.fetchData("
      ],
      "story_related": [
        "story_categories_setting'; // 本地存储的键名",
        "loadStoryDetail(story) {",
        "story_category',options);",
        "story_id:story.id}}",
        "story.category_name}</div>",
        "story.png\" alt=\"小故事铺\" class=\"logo-img\">",
        "story.title}</div>",
        "story.excerpt}</div>",
        "story of storiesToRender) {",
        "story).replace(/\\\"/g, \"'\")})\">",
        "loadStoryDetail(${JSON.stringify(story).replace(/\\\"/g, \"'\")})\">",
        "story_view_mode'; // 视图模式存储键名"
      ],
      "routing_logic": [],
      "database_operations": [
        "supabaseClient中的方法",
        "supabaseClient.fetchData('story_category',options);",
        "Supabase数据出错:', error);",
        "supabaseClient.fetchData('story_content',options);",
        "supabaseClient.fetchData('story_main',options);"
      ]
    }
  },
  "network_analysis": {
    "story_1": {
      "requests": [],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/1",
      "page_title": "小故事铺"
    },
    "story_2": {
      "requests": [],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/2",
      "page_title": "小故事铺"
    },
    "story_3": {
      "requests": [
        {
          "url": "https://storynook.cn/live2d/model/xiaoban/motions/Nemui.mtn",
          "method": "GET",
          "timestamp": 1760285640640
        }
      ],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/3",
      "page_title": "小故事铺"
    },
    "story_5": {
      "requests": [
        {
          "url": "https://storynook.cn/live2d/model/xiaoban/motions/Nemui.mtn",
          "method": "GET",
          "timestamp": 1760285649172
        }
      ],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/5",
      "page_title": "小故事铺"
    },
    "story_10": {
      "requests": [],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/10",
      "page_title": "小故事铺"
    },
    "story_100": {
      "requests": [
        {
          "url": "https://storynook.cn/live2d/model/xiaoban/motions/Nemui.mtn",
          "method": "GET",
          "timestamp": 1760285663909
        }
      ],
      "page_text_length": 5931,
      "current_url": "https://storynook.cn/#story/100",
      "page_title": "小故事铺"
    }
  },
  "api_analysis": {
    "https://storynook.cn/api/story/1": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/api/story/2": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/api/stories": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/story/1.json": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/story/2.json": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/data/story/1": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    },
    "https://storynook.cn/data/story/2": {
      "status_code": 404,
      "content_type": "text/plain; charset=utf-8",
      "content_length": 79,
      "success": false
    }
  },
  "supabase_analysis": {
    "supabase_info": {
      "global_vars": [
        {
          "name": "clientInformation",
          "type": "object",
          "value_preview": []
        },
        {
          "name": "indexedDB",
          "type": "object",
          "value_preview": []
        },
        {
          "name": "ondblclick",
          "type": "object",
          "value_preview": []
        },
        {
          "name": "supabase",
          "type": "object",
          "value_preview": [
            "PostgrestError",
            "FunctionsHttpError",
            "FunctionsFetchError",
            "FunctionsRelayError",
            "FunctionsError"
          ]
        },
        {
          "name": "supabaseClient",
          "type": "object",
          "value_preview": [
            "fetchData"
          ]
        }
      ],
      "supabase_client_exists": true,
      "supabase_exists": true
    },
    "story_load_test": {
      "loadStoryDetail_exists": true,
      "test_results": [
        {
          "result": {},
          "story_id": 1,
          "success": true
        }
      ]
    }
  },
  "recommendations": [
    {
      "type": "supabase_database",
      "description": "在supabase-client.js中发现数据库操作",
      "operations": [
        "supabaseClient;",
        "supabaseUrl = 'https://cxtvmolpayeplvdxcjvf.supabase.co';",
        "Supabase客户端",
        "supabase !== 'undefined') {",
        ".from("
      ],
      "implementation": "模拟Supabase数据库查询"
    },
    {
      "type": "javascript_function_call",
      "description": "在app.js中发现故事相关函数",
      "functions": [
        "story_categories_setting'; // 本地存储的键名",
        "loadStoryDetail(story) {",
        "story_category',options);",
        "story_id:story.id}}",
        "story.category_name}</div>"
      ],
      "implementation": "使用Selenium执行JavaScript函数来加载故事"
    },
    {
      "type": "supabase_database",
      "description": "在app.js中发现数据库操作",
      "operations": [
        "supabaseClient中的方法",
        "supabaseClient.fetchData('story_category',options);",
        "Supabase数据出错:', error);",
        "supabaseClient.fetchData('story_content',options);",
        "supabaseClient.fetchData('story_main',options);"
      ],
      "implementation": "模拟Supabase数据库查询"
    },
    {
      "type": "network_request_monitoring",
      "description": "发现动态网络请求",
      "unique_requests": [
        "https://storynook.cn/live2d/model/xiaoban/motions/Nemui.mtn"
      ],
      "implementation": "监控并复制网络请求模式"
    },
    {
      "type": "supabase_client_simulation",
      "description": "检测到Supabase客户端",
      "implementation": "模拟Supabase客户端调用"
    }
  ]
}